<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naar zee</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">  
    <link rel="stylesheet" href="https://unpkg.com/awsm.css/dist/awsm.min.css">
    <link rel="stylesheet" href="style.css">
    
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body x-data="{
    tonen: 0,
    stat: {
        geslacht: '',
        leeftijd:  0,
        professioneel: -1,
        leeftijdsgenootOpname: {
            audio: null,
            okay: false
        },
        oudereOpname: {
            audio: null,
            okay: false
        },
    },
    recorder: null,
    opnemen: false,
    indienen: function() {
        import('https://openfpcdn.io/fingerprintjs/v3.3.2/esm.min.js')
        .then(FingerprintJS => FingerprintJS.load())
        .then(fp => fp.get())
        .then(deelnemer => {
            const bowser = window.bowser.getParser(window.navigator.userAgent);

            const fd = new FormData();

            fd.append('deelnemer', deelnemer.visitorId);

            fd.append('geslacht', this.stat.geslacht);
            fd.append('leeftijd', this.stat.leeftijd);
            fd.append('professioneel', this.stat.professioneel);

            fd.append('leeftijdsgenootOpname', this.stat.leeftijdsgenootOpname.audio.audioBlob, 'leeftijdsgenootOpname_' + new Date().toISOString().split('T')[0] + '_' + deelnemer.visitorId + '.flac');
            fd.append('oudereOpname', this.stat.oudereOpname.audio.audioBlob, 'oudereOpname_' + new Date().toISOString().split('T')[0] + '_' + deelnemer.visitorId + '.flac');

            fd.append('browser', bowser.getBrowserName() + ' ' + bowser.getBrowserVersion());
            fd.append('os', bowser.getOSName() + ' ' + bowser.getOSVersion());
            fd.append('platform', bowser.getPlatformType());
            
            fetch('/', {
                method: 'POST',
                body: fd,
            })
            .then(r => r.json())
            .then(r => {
                this.okay = r.okay;
                this.resp = true;
            })
            .catch(() => {
                this.okay = false;
                this.resp = true;
            });
        });
    },
    resp: false,
    okay: false
}">
    <header>
        <h1>Naar zee met ...</h1>
    </header>
    <main>
        <article x-show="tonen === 0">
            <p>
                Hallo! In mijn bachelorproef toegepaste informatica bekijk ik of het mogelijk is dat
                een computer verschillen kan detecteren in het taalgebruik tussen leeftijdsgenoten en
                naar ouderen toe. Hiervoor is (uiteraard) data nodig.
            </p>
            <p>
                Ik heb twee scenario's uitgewerkt. Bij beide kan je een kort verhaal inspreken. Vooraf worden 
                nog een beperkt aantal gegevens gevraagd. Het geheel wordt anoniem verwerkt.
            </p>
            <p>
                Alvast bedankt!
            </p>
            <p>
                &mdash; Arne Govaerts
            </p>
            <button @click="tonen = 1">
                Beginnen
            </button>
        </article>
        <article x-cloak x-show="tonen === 1">
            <p>
                Op deze pagina wordt gevraagd naar enkele statistische gegevens om een globaal beeld te schetsen.
            </p>
            <form @submit.prevent="
                tonen               = 2;
                let fd              = new FormData($event.target);
                stat.geslacht       = fd.get('geslacht');
                stat.professioneel  = fd.get('professioneel');
            ">
                <label>Wat is je geslacht?</label>
                <label>
                    <input type="radio" name="geslacht" value="M" required>
                    Man
                </label>
                <label>
                    <input type="radio" name="geslacht" value="V">
                    Vrouw
                </label>
                <label>
                    <input type="radio" name="geslacht" value="X">
                    Andere
                </label>
                <label for="leeftijd">Wat is je leeftijd?</label>
                <input type="number" min="0" step="1" id="leeftijd" name="leeftijd" required x-model.number="stat.leeftijd">
                <label>Bent u professioneel bezig met patiÃ«nten of zorgbehoevenden?</label>
                <label>
                    <input type="radio" name="professioneel" value="J" required>
                    Ja
                </label>
                <label>
                    <input type="radio" name="professioneel" value="N">
                    Neen
                </label>
                <p></p>
                <input type="submit" value="Volgende" :disabled="stat.leeftijd === 0">
            </form>
        </article>
        <article x-cloak x-show="tonen === 2">
            <p>
                Nu krijgt u twee scenario's. Bij elk van deze scenario's neemt u telkens een kort
                geluidsfragment op. Je kan twee keer opnieuw proberen.
            </p>
            <h2>
                Scenario 1: Leeftijdsgenoot
            </h2>
            <p>
                Vertel aan een leeftijdsgenoot (bv. partner) die bij jou inwoont, dat je het plan hebt om
                morgen samen een daguitstap naar de zee te maken.
            </p>
            <p>
                Geef ook concreet aan wat je van je partner verwacht dat hij/zij meeneemt. Maak het plan
                concreet door bijvoorbeeld een voorstel te doen wat betreft het tijdstip waarop je graag
                zou vertrekken, of je met de wagen of de trein wil reizen, welke badplaats het wordt,
                wat je er graag wil doen, enz.
            </p>

            <button @click="recorder = await recordAudio(); recorder.start(); opnemen = true;">Start</button>
            <button @click="stat.leeftijdsgenootOpname.audio = await recorder.stop();  opnemen = false; stat.leeftijdsgenootOpname.okay = true">Stop</button>
            <template x-if="opnemen">
                <small><i>
                    Opnemen...
                </i></small>
            </template>
            <template x-if="stat.leeftijdsgenootOpname.audio !== null">
                <div>
                    <p></p>
                    <audio :src="stat.leeftijdsgenootOpname.audio.audioUrl" controls></audio>
                </div>
            </template>
            <p></p>
            <button @click="tonen = 3" :disabled="!stat.leeftijdsgenootOpname.okay">Volgende</button>
        </article>
        <article x-cloak x-show="tonen === 3">
            <h2>
                Scenario 2: Grootouder
            </h2>
            <p>
                Vertel aan je 90-jarige grootmoeder of grootvader dat je morgen samen een daguitstap naar
                de zee wil maken.
            </p>
            <p>
                Geef ook nu concreet aan wat je verwacht dat hij/zij meeneemt. Maak het plan opnieuw concreet
                door bijvoorbeeld een voorstel te doen wat betreft het tijdstip waarop je graag zou
                vertrekken, of je met de wagen of de trein wil reizen, welke badplaats het wordt, wat je er
                graag wil doen, enz.
            </p>
            <p>
                Communiceer bewust op betuttelende manier.
            </p>
            <button @click="recorder = await recordAudio(); recorder.start(); opnemen = true;">Start</button>
            <button @click="stat.oudereOpname.audio = await recorder.stop();  opnemen = false; stat.oudereOpname.okay = true;">Stop</button>
            <template x-if="opnemen">
                <small><i>
                    Opnemen...
                </i></small>
            </template>
            <template x-if="stat.oudereOpname.audio !== null">
                <div>
                    <p></p>
                    <audio :src="stat.oudereOpname.audio.audioUrl" controls></audio>
                </div>
            </template>
            <p></p>
            <button @click="tonen = 4; indienen()" :disabled="!stat.oudereOpname.okay">Indienen</button>
        </article>
        <article x-cloak x-show="tonen === 4">
            <p x-show="!resp">
                Aan het verzenden...
            </p>
            <p x-show="resp && okay">
                Uw inzending is goed geregistreerd. Nogmaals bedankt om deel te nemen.
            </p>
            <p x-show="resp && !okay">
                Er liep iets mis bij het indienen. Herlaad eventueel de pagina en probeer nogmaals.
            </p>
        </article>
    </main>
    <footer>
        <a href="https://www.hogent.be">
            <img src="HOGENT_Logo_Pos_rgb.png" alt="HOGENT">
        </a>
        <p></p>
        <a href="mailto:bachelorproef@arnegovaerts.be">bachelorproef@arnegovaerts.be</a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bowser@2.11.0/es5.min.js"></script>
    <script src="recorder.js"></script>
</body>

</html>